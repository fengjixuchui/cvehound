/// Files: arch/x86/kernel/kprobes/opt.c drivers/net/ethernet/intel/ice/ice_lib.c
/// Fix: 0d07c0ec4381f630c801539c79ad8dcc627f6e4a
/// Detect-To: efc2214b6047b6f5b4ca53151eba62521b9452d6

// We can't detect 7705dc8557973d8ad8f10840f61d8ec805695e9e
// because it modifies only arch/x86/kernel/vmlinux.lds.S
// file. Hence, use closest commit efc2214b6047b6f5b4ca53151eba62521b9452d6

virtual detect

// no relation with bug cause
@func exists@
@@

ice_vsi_cfg_frame_size(...)
{
	...
}

@err depends on func exists@
identifier paddr;
position p;
@@

can_optimize(unsigned long paddr)
{
	...
	if (insn.opcode.bytes[0] == \(INT3_INSN_OPCODE\|BREAKPOINT_INSTRUCTION\))
*		return 0;@p
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-3411 (Double check for :text =0x9090 in arch/x86/kernel/vmlinux.lds.S)')
